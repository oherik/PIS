QA12 - MC68HC12 Absolute crossassembler, Version 1.6.3
(c) GMV 1989-2013


File: Main.lst
                            1. 	use	Labdefs.s12
---- File: "Labdefs.s12"
                            2. ;Adresser
       0000 0600            3. DipSwitch	equ	$600
       0000 0700            4. HexDisplay	equ	$700
       0000 0400            5. DrillControl	equ	$400
       0000 0401            6. DrillStatus	equ	$401
                            7. 
000000                      8. #ifdef	SIMULATOR
                           14. #else
       0000 0004           15. DelayConst	EQU	4
                           16. #endif000000                     17. 	
---- File: "C:\Users\Erik\Documents\GitHub\PIS\Bokuppgifter\Main.s12"
001000                     18. 	org	$1000
001000                     19. 	
                           20. ;----------------------------------
                           21. ;	MAIN
                           22. ;----------------------------------	
001000                     23. 	
001000                     24. main_loop:
001000 16 10 4D            25. 	jsr	GetKbdML15	; Tangent till register B
001003 16 10 08            26. 	jsr	Command
001006 20 F8               27. 	bra	main_loop
001008                     28. 	
                           29. ;----------------------------------
                           30. ;	COMMAND
                           31. ;----------------------------------	
                           32. 
001008                     33. Command:
001008 C1 07               34. 	cmpb	#7
00100A 22 08               35. 	bhi	CommandExit
00100C CE 10 15            36. 	ldx	#JUMPTAB
00100F 58                  37. 	aslb		; 2 bytes per adress
001010                     38. 	ldx	b,x	; ladda rutinen
001012 15 00               39. 	jsr	,x
001014                     40. CommandExit:
001014 3D                  41. 	rts
                           42. 
                           43. ;---------------------------------
                           44. ;	Tabell med kommandon
                           45. 
001015 20 55 20 6B 20 75   46. JUMPTAB	fdb	MotorStart,MotorStop,DrillDown,DrillUp
       20 7F            
00101D 10 25 10 2B 10 31   47. 	fdb	SUB4,SUB5,SUB6,SUB7
       10 37            
001025                     48. 	
                           49. ;---------------------------------
                           50. ;	Subrutiner fˆr test
                           51. 
       0000 0400           52. OutPortM	equ	$400
                           53. 
001025 18 0B 00 04 00      54. SUB4	movb	#0,OutPortM
00102A 3D                  55. 	rts
00102B 18 0B 00 04 00      56. SUB5	movb	#0,OutPortM
001030 3D                  57. 	rts
001031 18 0B 00 04 00      58. SUB6	movb	#0,OutPortM
001036 3D                  59. 	rts
001037 18 0B 00 04 00      60. SUB7	movb	#0,OutPortM
00103C 3D                  61. 	rts
00103D                     62. 		
                           63. ;-------------------------------
                           64. ;	File uses
                           65. ;-------------------------------	
00103D                     66. 	
00103D                     67. 	;use	ML15drvr.s12
                           68. 	use	KeyboardML15.s12
---- File: "KeyboardML15.s12"
                           69. ;Testprogram
                           70. ;	org	$1000
                           71. ;start:	jsr	GetKbdML15
                           72. ;	cmpb	#$FF
                           73. ;	beq	start
                           74. ;	nop
                           75. ;	bra	start
                           76. ;	ldx	#tabell
                           77. ;start:	jsr	DisplayML15
                           78. ;	bra	start
                           79. ;
                           80. ;tabell:	fcb	1,2,3,4,5,6
                           81. 
00103D                     82. 	
00103D                     83. CheckKbdML15:
00103D F6 09 C0            84. 	ldab	$9c0
001040 2A 03               85. 	bpl	CheckKbd_VA
001042 C6 FF               86. 	ldab	#$FF	
001044 3D                  87. 	rts
001045                     88. CheckKbd_VA:
001045 37                  89. 	pshb
001046                     90. CheckKbd_VA_active:
001046 F6 09 C0            91. 	ldab	$9c0
001049 2A FB               92. 	bpl	CheckKbd_VA_active
00104B 33                  93. 	pulb
00104C 3D                  94. 	rts
00104D                     95. 	
00104D                     96. GetKbdML15:
00104D 16 10 3D            97. 	jsr	CheckKbdML15
001050 C1 FF               98. 	cmpb	#$FF
001052 27 F9               99. 	beq	GetKbdML15
001054 3D                 100. 	rts
001055                    101. 	
001055                    102. DisplayML15:
001055 86 01              103. 	ldaa	#1
001057 7A 09 C2           104. 	staa	$9c2
00105A 86 D0              105. 	ldaa	#$d0
00105C 7A 09 C3           106. 	staa	$9c3
00105F 86 00              107. 	ldaa	#0
001061 7A 09 C2           108. 	staa	$9c2
001064                    109. DisplayML15_compare_loop:
001064 81 06              110. 	cmpa	#6
001066 26 09              111. 	bne	DisplayML15_not_6
001068 86 00              112. 	ldaa	#0
00106A 7A 09 C3           113. 	staa	$9c3
00106D 7A 09 C3           114. 	staa	$9c3
001070 3D                 115. 	rts
001071                    116. DisplayML15_not_6
001071                    117. 	ldab	a,x
001073 7B 09 C3           118. 	stab	$9c3
001076 42                 119. 	inca
001077 20 EB              120. 	bra	DisplayML15_compare_loop
                          121. 
001079                    122. 	
001079                    123. 	001079                    124. 	;use	Delay.s12
---- File: "C:\Users\Erik\Documents\GitHub\PIS\Bokuppgifter\Main.s12"
                          125. 	use	Subroutines.s12
---- File: "Subroutines.s12"
                          126. #define	SIMUATOR
                          127. #define	RUNFAST
                          128. 		use	Labdefs.s12
---- File: "Labdefs.s12"
                          129. ;Adresser
       0000 0600          130. DipSwitch	equ	$600
       0000 0700          131. HexDisplay	equ	$700
       0000 0400          132. DrillControl	equ	$400
       0000 0401          133. DrillStatus	equ	$401
                          134. 
001079                    135. #ifdef	SIMULATOR
                          141. #else
       0000 0004          142. DelayConst	EQU	4
                          143. #endif                          144. 		use	Delay.s12
---- File: "Delay.s12"
                          145. 	use	Labdefs.s12
---- File: "Labdefs.s12"
                          146. ;Adresser
       0000 0600          147. DipSwitch	equ	$600
       0000 0700          148. HexDisplay	equ	$700
       0000 0400          149. DrillControl	equ	$400
       0000 0401          150. DrillStatus	equ	$401
                          151. 
001079                    152. #ifdef	SIMULATOR
                          158. #else
       0000 0004          159. DelayConst	EQU	4
                          160. #endif002000                    161. 	org	$2000
---- File: "Delay.s12"
002000 34                 162. DELAY:	pshx		; 250 ms delay
002001 35                 163. 	pshy
002002 CE 00 04           164. 	ldx	#DelayConst
002005 1A 1F              165. NEXT:	leax	-1,x
002007 CD 00 64           166. 	ldy	#100
00200A 19 5F              167. NEXT2:	leay	-1,y
00200C 8D 00 00           168. 	cpy	#0
00200F 26 F9              169. 	bne	NEXT2
002011 8E 00 00           170. 	cpx	#0
002014 26 EF              171. 	bne	NEXT
002016 31                 172. 	puly
002017 30                 173. 	pulx
002018 3D                 174. 	rts	
002019                    175. 	
002019                    176. DELAY_B:		; Calls DELAY the number of times specified in B
002019 37                 177. 	pshb
00201A D7                 178. 	tstb
00201B                    179. DELAY_B_LOOP:
00201B 27 06              180. 	beq	DELAY_B_RETURN
00201D 16 20 00           181. 	jsr	DELAY
002020 53                 182. 	decb
002021 20 F8              183. 	bra	DELAY_B_LOOP
002023                    184. DELAY_B_RETURN:
002023 33                 185. 	pulb
002024 3D                 186. 	rts                           187. 
---- File: "Subroutines.s12"
002025 00                 188. DCShadow	rmb	1	; DrillControl shadow	
002026                    189. 		
                          190. ;---------------------------------
                          191. ;	OUTZERO
                          192. ;---------------------------------
                          193. 
                          194. ; Nollst√§ll biten i B-registret, med f√∂rprogrammerade bitm√∂nster
                          195. 
002026                    196. Outzero:			
002026 39                 197. 		pshc	; L√§gg register p√• stacken f√∂r senare √•terst√§llning
002027 37                 198. 		pshb
002028 C1 07              199. 		cmpb	#7		
00202A 22 0F              200. 		bhi	Outzero_return	; Kolla om talet √§r >7
00202C CE 20 AA           201. 		ldx	#Bitmask
00202F                    202. Outzero_loop:
00202F                    203. 		ldab	b,x				; Uppdatera b till bitmasken f√∂r b
002031 51                 204. 		comb	
002032 F4 20 25           205. 		andb	DCShadow		; Ta DCShadow && komplementet av bitmasken
002035 7B 04 00           206. 		stab	DrillControl	; Spara till borren
002038 7B 20 25           207. 		stab	DCShadow	; Spara till skuggningen
00203B                    208. Outzero_return:	
00203B 33                 209. 		pulb			; √Öterst√§ll originalv√§rden
00203C 38                 210. 		pulc
00203D 3D                 211. 		rts
00203E                    212. 	
                          213. ;---------------------------------
                          214. ;	OUTONE
                          215. ;---------------------------------
                          216. 
                          217. ; Ettst√§ll biten i B-registret, med f√∂rprogrammerade bitm√∂nster
                          218. 
00203E                    219. Outone:			
00203E 39                 220. 		pshc	; L√§gg register p√• stacken f√∂r senare √•terst√§llning
00203F 37                 221. 		pshb
002040 C1 07              222. 		cmpb	#7		
002042 22 0E              223. 		bhi	Outone_return	; Kolla om talet √§r >7
002044 CE 20 AA           224. 		ldx	#Bitmask
002047                    225. Outone_loop:
002047                    226. 		ldab	b,x	
002049 FA 20 25           227. 		orab	DCShadow	; Ta DCShadow || Bitmasken
00204C 7B 04 00           228. 		stab	DrillControl	; Spara till borren
00204F 7B 20 25           229. 		stab	DCShadow	; Spara till skuggningen
002052                    230. Outone_return:	
002052 33                 231. 		pulb			; √Öterst√§ll originalv√§rden
002053 38                 232. 		pulc
002054 3D                 233. 		rts
002055                    234. 		
                          235. ;-------------------------------
                          236. ;	MOTORSTART
                          237. ;-------------------------------
                          238. 
002055                    239. MotorStart:
002055 37                 240. 	pshb
002056 39                 241. 	pshc
002057 F6 20 25           242. 	ldab	DCShadow
00205A C4 04              243. 	andb	#4
00205C 26 0A              244. 	bne	MotorStartExit	; Motorn redan startad
00205E C6 02              245. 	ldab	#2
002060 16 20 3E           246. 	jsr	Outone		; Ettst√§ll bit 2
002063                    247. 	
002063 C6 02              248. 	ldab	#2
002065 16 20 19           249. 	jsr	DELAY_B	; 4*250 ms delay
                          250. 
002068                    251. MotorStartExit:
002068 38                 252. 	pulc
002069 33                 253. 	pulb
00206A 3D                 254. 	rts
00206B                    255. 	
                          256. ;-------------------------------
                          257. ;	MOTORSTOP
                          258. ;-------------------------------
                          259. 
00206B                    260. MotorStop:
00206B 37                 261. 	pshb
00206C 39                 262. 	pshc
00206D C6 02              263. 	ldab	#2
00206F 16 20 26           264. 	jsr	Outzero		; Nollst√§ll bit 2
002072 38                 265. 	pulc
002073 33                 266. 	pulb
002074 3D                 267. 	rts
002075                    268. 	
                          269. ;-------------------------------
                          270. ;	DRILLDOWN
                          271. ;-------------------------------
                          272. 
002075                    273. DrillDown:
002075 37                 274. 	pshb
002076 39                 275. 	pshc
002077 C6 03              276. 	ldab	#3		; Bit nummer 3 ‰r vridmagneten
002079 16 20 3E           277. 	jsr	Outone		; Ettst‰ll denna
00207C 38                 278. 	pulc
00207D 33                 279. 	pulb
00207E 3D                 280. 	rts
00207F                    281. 	
                          282. ;-------------------------------
                          283. ;	DRILLUP
                          284. ;-------------------------------
                          285. 
00207F                    286. DrillUp:
00207F 37                 287. 	pshb
002080 39                 288. 	pshc
002081 C6 03              289. 	ldab	#3		; Bit nummer 3 ‰r vridmagneten
002083 16 20 26           290. 	jsr	Outzero		; Nollst‰ll denna
002086 38                 291. 	pulc
002087 33                 292. 	pulb
002088 3D                 293. 	rts
002089                    294. 	
                          295. ;-------------------------------
                          296. ;	ALARM
                          297. ;-------------------------------
                          298. 
                          299. ; Antalet alarm ska finnas i B-registret
                          300. 
002089                    301. Alarm:
002089 39                 302. 	pshc
00208A B7 10              303. 	tfr	b,a
00208C 97                 304. 	tsta
00208D 27 19              305. 	beq	AlarmReturn
00208F                    306. 			; Bit nummer 4 ‰r larm
00208F                    307. AlarmSend:
00208F C6 04              308. 	ldab	#4		; S‰tt pÂ alarm
002091 16 20 3E           309. 	jsr	Outone
002094                    310. 	
002094 C6 04              311. 	ldab	#4
002096 16 20 19           312. 	jsr	DELAY_B		; 4*250 ms delay
002099                    313. 	
002099 C6 04              314. 	ldab	#4		; St‰ng av alarm
00209B 16 20 26           315. 	jsr	Outzero
00209E                    316. 	
00209E 43                 317. 	deca			
00209F 27 07              318. 	beq	AlarmReturn
0020A1                    319. 	
0020A1 C6 02              320. 	ldab	#2		; 2*250 ms delay
0020A3 16 20 19           321. 	jsr	DELAY_B
0020A6                    322. 	
0020A6 20 E7              323. 	bra	AlarmSend
0020A8                    324. AlarmReturn:
0020A8 38                 325. 	pulc
0020A9 3D                 326. 	rts
0020AA                    327. 	
0020AA                    328. 	
0020AA                    329. 	
0020AA                    330. 	
                          331. 
                          332. 
                          333. ;-------------------------------	
                          334. ;	Bitmasks
                          335. ;-------------------------------
                          336. 
0020AA 01 02 04 08 10 20  337. Bitmask:	fcb	1,2,4,8,16,32,64,128
       40 80            
0020B2                    338. 		
                          339. 
0020B2                    340. 		
0020B2                    341. 	
0020B2                    342. 		
0020B2                    343. 		
0020B2                    344. 	
---- File: "C:\Users\Erik\Documents\GitHub\PIS\Bokuppgifter\Main.s12"
                          345. ;------------------------------
                          346. ;	Globala variabler
                          347. ;------------------------------
                          348. 
0020B2                    349. 	