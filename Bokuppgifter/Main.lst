QA12 - MC68HC12 Absolute crossassembler, Version 1.6.3
(c) GMV 1989-2013


File: Main.lst
                            1. 	use	Labdefs.s12
---- File: "Labdefs.s12"
                            2. ;Adresser
       0000 0600            3. DipSwitch	equ	$600
       0000 0700            4. HexDisplay	equ	$700
       0000 0400            5. DrillControl	equ	$400
       0000 0401            6. DrillStatus	equ	$401
                            7. 
000000                      8. #ifdef	SIMULATOR
                           14. #else
       0000 0004           15. DelayConst	EQU	4
                           16. #endif000000                     17. 	
---- File: "C:\Users\Erik\Documents\GitHub\PIS\Bokuppgifter\Main.s12"
001000                     18. 	org	$1000
001000                     19. 	
                           20. ;----------------------------------
                           21. ;	MAIN
                           22. ;----------------------------------	
001000                     23. 	
001000                     24. main_loop:
001000 16 10 4D            25. 	jsr	GetKbdML15	; Tangent till register B
001003 16 10 08            26. 	jsr	Command
001006 20 F8               27. 	bra	main_loop
001008                     28. 	
                           29. ;----------------------------------
                           30. ;	COMMAND
                           31. ;----------------------------------	
                           32. 
001008                     33. Command:
001008 C1 07               34. 	cmpb	#7
00100A 22 08               35. 	bhi	CommandExit
00100C CE 10 15            36. 	ldx	#JUMPTAB
00100F 58                  37. 	aslb		; 2 bytes per adress
001010                     38. 	ldx	b,x	; ladda rutinen
001012 15 00               39. 	jsr	,x
001014                     40. CommandExit:
001014 3D                  41. 	rts
                           42. 
                           43. ;---------------------------------
                           44. ;	Tabell med kommandon
                           45. 
001015 20 49 20 64 20 6C   46. JUMPTAB	fdb	MotorStart,MotorStop,DrillDown,DrillUp
       20 74            
00101D 10 25 10 2B 10 31   47. 	fdb	SUB4,SUB5,SUB6,SUB7
       10 37            
001025                     48. 	
                           49. ;---------------------------------
                           50. ;	Subrutiner f他 test
                           51. 
       0000 0400           52. OutPortM	equ	$400
                           53. 
001025 18 0B 00 04 00      54. SUB4	movb	#0,OutPortM
00102A 3D                  55. 	rts
00102B 18 0B 00 04 00      56. SUB5	movb	#0,OutPortM
001030 3D                  57. 	rts
001031 18 0B 00 04 00      58. SUB6	movb	#0,OutPortM
001036 3D                  59. 	rts
001037 18 0B 00 04 00      60. SUB7	movb	#0,OutPortM
00103C 3D                  61. 	rts
00103D                     62. 		
                           63. ;-------------------------------
                           64. ;	File uses
                           65. ;-------------------------------	
00103D                     66. 	
00103D                     67. 	;use	ML15drvr.s12
                           68. 	use	KeyboardML15.s12
---- File: "KeyboardML15.s12"
                           69. ;Testprogram
                           70. ;	org	$1000
                           71. ;start:	jsr	GetKbdML15
                           72. ;	cmpb	#$FF
                           73. ;	beq	start
                           74. ;	nop
                           75. ;	bra	start
                           76. ;	ldx	#tabell
                           77. ;start:	jsr	DisplayML15
                           78. ;	bra	start
                           79. ;
                           80. ;tabell:	fcb	1,2,3,4,5,6
                           81. 
00103D                     82. 	
00103D                     83. CheckKbdML15:
00103D F6 09 C0            84. 	ldab	$9c0
001040 2A 03               85. 	bpl	CheckKbd_VA
001042 C6 FF               86. 	ldab	#$FF	
001044 3D                  87. 	rts
001045                     88. CheckKbd_VA:
001045 37                  89. 	pshb
001046                     90. CheckKbd_VA_active:
001046 F6 09 C0            91. 	ldab	$9c0
001049 2A FB               92. 	bpl	CheckKbd_VA_active
00104B 33                  93. 	pulb
00104C 3D                  94. 	rts
00104D                     95. 	
00104D                     96. GetKbdML15:
00104D 16 10 3D            97. 	jsr	CheckKbdML15
001050 C1 FF               98. 	cmpb	#$FF
001052 27 F9               99. 	beq	GetKbdML15
001054 3D                 100. 	rts
001055                    101. 	
001055                    102. DisplayML15:
001055 86 01              103. 	ldaa	#1
001057 7A 09 C2           104. 	staa	$9c2
00105A 86 D0              105. 	ldaa	#$d0
00105C 7A 09 C3           106. 	staa	$9c3
00105F 86 00              107. 	ldaa	#0
001061 7A 09 C2           108. 	staa	$9c2
001064                    109. DisplayML15_compare_loop:
001064 81 06              110. 	cmpa	#6
001066 26 09              111. 	bne	DisplayML15_not_6
001068 86 00              112. 	ldaa	#0
00106A 7A 09 C3           113. 	staa	$9c3
00106D 7A 09 C3           114. 	staa	$9c3
001070 3D                 115. 	rts
001071                    116. DisplayML15_not_6
001071                    117. 	ldab	a,x
001073 7B 09 C3           118. 	stab	$9c3
001076 42                 119. 	inca
001077 20 EB              120. 	bra	DisplayML15_compare_loop
                          121. 
001079                    122. 	
001079                    123. 	001079                    124. 	;use	Delay.s12
---- File: "C:\Users\Erik\Documents\GitHub\PIS\Bokuppgifter\Main.s12"
                          125. 	use	Subroutines.s12
---- File: "Subroutines.s12"
                          126. #define	SIMUATOR
                          127. #define	RUNFAST
                          128. 		use	Labdefs.s12
---- File: "Labdefs.s12"
                          129. ;Adresser
       0000 0600          130. DipSwitch	equ	$600
       0000 0700          131. HexDisplay	equ	$700
       0000 0400          132. DrillControl	equ	$400
       0000 0401          133. DrillStatus	equ	$401
                          134. 
001079                    135. #ifdef	SIMULATOR
                          141. #else
       0000 0004          142. DelayConst	EQU	4
                          143. #endif                          144. 		use	Delay.s12
---- File: "Delay.s12"
                          145. 	use	Labdefs.s12
---- File: "Labdefs.s12"
                          146. ;Adresser
       0000 0600          147. DipSwitch	equ	$600
       0000 0700          148. HexDisplay	equ	$700
       0000 0400          149. DrillControl	equ	$400
       0000 0401          150. DrillStatus	equ	$401
                          151. 
001079                    152. #ifdef	SIMULATOR
                          158. #else
       0000 0004          159. DelayConst	EQU	4
                          160. #endif002000                    161. 	org	$2000
---- File: "Delay.s12"
002000 34                 162. DELAY:	pshx
002001 35                 163. 	pshy
002002 CE 00 04           164. 	ldx	#DelayConst
002005 1A 1F              165. NEXT:	leax	-1,x
002007 CD 00 64           166. 	ldy	#100
00200A 19 5F              167. NEXT2:	leay	-1,y
00200C 8D 00 00           168. 	cpy	#0
00200F 26 F9              169. 	bne	NEXT2
002011 8E 00 00           170. 	cpx	#0
002014 26 EF              171. 	bne	NEXT
002016 31                 172. 	puly
002017 30                 173. 	pulx
002018 3D                 174. 	rts	                          175. 
---- File: "Subroutines.s12"
002019 00                 176. DCShadow	rmb	1	; DrillControl shadow	
00201A                    177. 		
                          178. ;---------------------------------
                          179. ;	OUTZERO
                          180. ;---------------------------------
                          181. 
                          182. ; Nollst칛ll biten i B-registret, med f칬rprogrammerade bitm칬nster
                          183. 
00201A                    184. Outzero:			
00201A 39                 185. 		pshc	; L칛gg register p친 stacken f칬r senare 친terst칛llning
00201B 37                 186. 		pshb
00201C C1 07              187. 		cmpb	#7		
00201E 22 0F              188. 		bhi	Outzero_return	; Kolla om talet 칛r >7
002020 CE 20 7C           189. 		ldx	#Bitmask
002023                    190. Outzero_loop:
002023                    191. 		ldab	b,x				; Uppdatera b till bitmasken f칬r b
002025 51                 192. 		comb	
002026 F4 20 19           193. 		andb	DCShadow		; Ta DCShadow && komplementet av bitmasken
002029 7B 04 00           194. 		stab	DrillControl	; Spara till borren
00202C 7B 20 19           195. 		stab	DCShadow	; Spara till skuggningen
00202F                    196. Outzero_return:	
00202F 33                 197. 		pulb			; 칀terst칛ll originalv칛rden
002030 38                 198. 		pulc
002031 3D                 199. 		rts
002032                    200. 	
                          201. ;---------------------------------
                          202. ;	OUTONE
                          203. ;---------------------------------
                          204. 
                          205. ; Ettst칛ll biten i B-registret, med f칬rprogrammerade bitm칬nster
                          206. 
002032                    207. Outone:			
002032 39                 208. 		pshc	; L칛gg register p친 stacken f칬r senare 친terst칛llning
002033 37                 209. 		pshb
002034 C1 07              210. 		cmpb	#7		
002036 22 0E              211. 		bhi	Outone_return	; Kolla om talet 칛r >7
002038 CE 20 7C           212. 		ldx	#Bitmask
00203B                    213. Outone_loop:
00203B                    214. 		ldab	b,x	
00203D FA 20 19           215. 		orab	DCShadow	; Ta DCShadow || Bitmasken
002040 7B 04 00           216. 		stab	DrillControl	; Spara till borren
002043 7B 20 19           217. 		stab	DCShadow	; Spara till skuggningen
002046                    218. Outone_return:	
002046 33                 219. 		pulb			; 칀terst칛ll originalv칛rden
002047 38                 220. 		pulc
002048 3D                 221. 		rts
002049                    222. 		
                          223. ;-------------------------------
                          224. ;	MOTORSTART
                          225. ;-------------------------------
                          226. 
002049                    227. MotorStart:
002049 37                 228. 	pshb
00204A F6 20 19           229. 	ldab	DCShadow
00204D C4 04              230. 	andb	#4
00204F 26 11              231. 	bne	MotorStartExit	; Motorn redan startad
002051 C6 02              232. 	ldab	#2
002053 16 20 32           233. 	jsr	Outone		; Ettst칛ll bit 2
002056 16 20 00           234. 	jsr	DELAY		; 4*250ms f칬rdr칬jning
002059 16 20 00           235. 	jsr	DELAY
00205C 16 20 00           236. 	jsr	DELAY
00205F 16 20 00           237. 	jsr	DELAY
                          238. 
002062                    239. MotorStartExit:
002062 33                 240. 	pulb
002063 3D                 241. 	rts
002064                    242. 	
                          243. ;-------------------------------
                          244. ;	MOTORSTOP
                          245. ;-------------------------------
                          246. 
002064                    247. MotorStop:
002064 37                 248. 	pshb
002065 C6 02              249. 	ldab	#2
002067 16 20 1A           250. 	jsr	Outzero		; Nollst칛ll bit 2
00206A 33                 251. 	pulb
00206B 3D                 252. 	rts
00206C                    253. 	
                          254. ;-------------------------------
                          255. ;	DRILLDOWN
                          256. ;-------------------------------
                          257. 
00206C                    258. DrillDown:
00206C 37                 259. 	pshb
00206D C6 03              260. 	ldab	#3		; Bit nummer 3 雷 vridmagneten
00206F 16 20 32           261. 	jsr	Outone		; Ettst農l denna
002072 33                 262. 	pulb
002073 3D                 263. 	rts
002074                    264. 	
                          265. ;-------------------------------
                          266. ;	DRILLUP
                          267. ;-------------------------------
                          268. 
002074                    269. DrillUp:
002074 37                 270. 	pshb
002075 C6 03              271. 	ldab	#3		; Bit nummer 3 雷 vridmagneten
002077 16 20 1A           272. 	jsr	Outzero		; Nollst農l denna
00207A 33                 273. 	pulb
00207B 3D                 274. 	rts
00207C                    275. 	
                          276. ;-------------------------------	
                          277. ;	Bitmasks
                          278. ;-------------------------------
                          279. 
00207C 01 02 04 08 10 20  280. Bitmask:	fcb	1,2,4,8,16,32,64,128
       40 80            
002084                    281. 		
                          282. 
002084                    283. 		
002084                    284. 	
002084                    285. 		
002084                    286. 		
002084                    287. 	
---- File: "C:\Users\Erik\Documents\GitHub\PIS\Bokuppgifter\Main.s12"
                          288. ;------------------------------
                          289. ;	Globala variabler
                          290. ;------------------------------
                          291. 
002084                    292. 	