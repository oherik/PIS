QA12 - MC68HC12 Absolute crossassembler, Version 1.6.3
(c) GMV 1989-2013


File: Main.lst
                            1. 	use	Labdefs.s12
---- File: "Labdefs.s12"
                            2. ;Adresser
       0000 0600            3. DipSwitch	equ	$600
       0000 0700            4. HexDisplay	equ	$700
       0000 0400            5. DrillControl	equ	$400
       0000 0401            6. DrillStatus	equ	$401
                            7. 
000000                      8. #ifdef	SIMULATOR
                           14. #else
       0000 0004           15. DelayConst	EQU	4
                           16. #endif000000                     17. 	
---- File: "C:\Users\Erik\Documents\GitHub\PIS\Bokuppgifter\Main.s12"
001000                     18. 	org	$1000
001000                     19. 	
                           20. ;----------------------------------
                           21. ;	MAIN
                           22. ;----------------------------------	
001000                     23. 	
001000                     24. main_loop:
001000 16 10 65            25. 	jsr	GetKbdML15	; Tangent till register B
001003 16 10 08            26. 	jsr	Command
001006 20 F8               27. 	bra	main_loop
001008                     28. 	
                           29. ;----------------------------------
                           30. ;	COMMAND
                           31. ;----------------------------------	
                           32. 
001008                     33. Command:
001008 C1 07               34. 	cmpb	#7
00100A 22 08               35. 	bhi	CommandExit
00100C CE 10 15            36. 	ldx	#JUMPTAB
00100F 58                  37. 	aslb		; 2 bytes per adress
001010                     38. 	ldx	b,x	; ladda rutinen
001012 15 00               39. 	jsr	,x
001014                     40. CommandExit:
001014 3D                  41. 	rts
                           42. 
                           43. ;---------------------------------
                           44. ;	Tabell med kommandon
                           45. 
001015 20 49 20 64 10 31   46. JUMPTAB	fdb	MotorStart,MotorStop,SUB2,SUB3
       10 37            
00101D 10 3D 10 43 10 49   47. 	fdb	SUB4,SUB5,SUB6,SUB7
       10 4F            
001025                     48. 	
                           49. ;---------------------------------
                           50. ;	Subrutiner f他 test
                           51. 
       0000 0400           52. OutPortM	equ	$400
                           53. 
001025 18 0B 00 04 00      54. SUB0	movb	#0,OutPortM
00102A 3D                  55. 	rts
00102B 18 0B 00 04 00      56. SUB1	movb	#0,OutPortM
001030 3D                  57. 	rts
001031 18 0B 00 04 00      58. SUB2	movb	#0,OutPortM
001036 3D                  59. 	rts
001037 18 0B 00 04 00      60. SUB3	movb	#0,OutPortM
00103C 3D                  61. 	rts
00103D 18 0B 00 04 00      62. SUB4	movb	#0,OutPortM
001042 3D                  63. 	rts
001043 18 0B 00 04 00      64. SUB5	movb	#0,OutPortM
001048 3D                  65. 	rts
001049 18 0B 00 04 00      66. SUB6	movb	#0,OutPortM
00104E 3D                  67. 	rts
00104F 18 0B 00 04 00      68. SUB7	movb	#0,OutPortM
001054 3D                  69. 	rts
001055                     70. 		
                           71. ;-------------------------------
                           72. ;	File uses
                           73. ;-------------------------------	
001055                     74. 	
001055                     75. 	;use	ML15drvr.s12
                           76. 	use	KeyboardML15.s12
---- File: "KeyboardML15.s12"
                           77. ;Testprogram
                           78. ;	org	$1000
                           79. ;start:	jsr	GetKbdML15
                           80. ;	cmpb	#$FF
                           81. ;	beq	start
                           82. ;	nop
                           83. ;	bra	start
                           84. ;	ldx	#tabell
                           85. ;start:	jsr	DisplayML15
                           86. ;	bra	start
                           87. ;
                           88. ;tabell:	fcb	1,2,3,4,5,6
                           89. 
001055                     90. 	
001055                     91. CheckKbdML15:
001055 F6 09 C0            92. 	ldab	$9c0
001058 2A 03               93. 	bpl	CheckKbd_VA
00105A C6 FF               94. 	ldab	#$FF	
00105C 3D                  95. 	rts
00105D                     96. CheckKbd_VA:
00105D 37                  97. 	pshb
00105E                     98. CheckKbd_VA_active:
00105E F6 09 C0            99. 	ldab	$9c0
001061 2A FB              100. 	bpl	CheckKbd_VA_active
001063 33                 101. 	pulb
001064 3D                 102. 	rts
001065                    103. 	
001065                    104. GetKbdML15:
001065 16 10 55           105. 	jsr	CheckKbdML15
001068 C1 FF              106. 	cmpb	#$FF
00106A 27 F9              107. 	beq	GetKbdML15
00106C 3D                 108. 	rts
00106D                    109. 	
00106D                    110. DisplayML15:
00106D 86 01              111. 	ldaa	#1
00106F 7A 09 C2           112. 	staa	$9c2
001072 86 D0              113. 	ldaa	#$d0
001074 7A 09 C3           114. 	staa	$9c3
001077 86 00              115. 	ldaa	#0
001079 7A 09 C2           116. 	staa	$9c2
00107C                    117. DisplayML15_compare_loop:
00107C 81 06              118. 	cmpa	#6
00107E 26 09              119. 	bne	DisplayML15_not_6
001080 86 00              120. 	ldaa	#0
001082 7A 09 C3           121. 	staa	$9c3
001085 7A 09 C3           122. 	staa	$9c3
001088 3D                 123. 	rts
001089                    124. DisplayML15_not_6
001089                    125. 	ldab	a,x
00108B 7B 09 C3           126. 	stab	$9c3
00108E 42                 127. 	inca
00108F 20 EB              128. 	bra	DisplayML15_compare_loop
                          129. 
001091                    130. 	
001091                    131. 	001091                    132. 	;use	Delay.s12
---- File: "C:\Users\Erik\Documents\GitHub\PIS\Bokuppgifter\Main.s12"
                          133. 	use	Subroutines.s12
---- File: "Subroutines.s12"
                          134. #define	SIMUATOR
                          135. #define	RUNFAST
                          136. 		use	Labdefs.s12
---- File: "Labdefs.s12"
                          137. ;Adresser
       0000 0600          138. DipSwitch	equ	$600
       0000 0700          139. HexDisplay	equ	$700
       0000 0400          140. DrillControl	equ	$400
       0000 0401          141. DrillStatus	equ	$401
                          142. 
001091                    143. #ifdef	SIMULATOR
                          149. #else
       0000 0004          150. DelayConst	EQU	4
                          151. #endif                          152. 		use	Delay.s12
---- File: "Delay.s12"
                          153. 	use	Labdefs.s12
---- File: "Labdefs.s12"
                          154. ;Adresser
       0000 0600          155. DipSwitch	equ	$600
       0000 0700          156. HexDisplay	equ	$700
       0000 0400          157. DrillControl	equ	$400
       0000 0401          158. DrillStatus	equ	$401
                          159. 
001091                    160. #ifdef	SIMULATOR
                          166. #else
       0000 0004          167. DelayConst	EQU	4
                          168. #endif002000                    169. 	org	$2000
---- File: "Delay.s12"
002000 34                 170. DELAY:	pshx
002001 35                 171. 	pshy
002002 CE 00 04           172. 	ldx	#DelayConst
002005 1A 1F              173. NEXT:	leax	-1,x
002007 CD 00 64           174. 	ldy	#100
00200A 19 5F              175. NEXT2:	leay	-1,y
00200C 8D 00 00           176. 	cpy	#0
00200F 26 F9              177. 	bne	NEXT2
002011 8E 00 00           178. 	cpx	#0
002014 26 EF              179. 	bne	NEXT
002016 31                 180. 	puly
002017 30                 181. 	pulx
002018 3D                 182. 	rts	                          183. 
---- File: "Subroutines.s12"
002019 00                 184. DCShadow	rmb	1	; DrillControl shadow	
00201A                    185. 		
                          186. ;---------------------------------
                          187. ;	OUTZERO
                          188. ;---------------------------------
                          189. 
                          190. ; Nollst칛ll biten i B-registret, med f칬rprogrammerade bitm칬nster
                          191. 
00201A                    192. Outzero:			
00201A 39                 193. 		pshc	; L칛gg register p친 stacken f칬r senare 친terst칛llning
00201B 37                 194. 		pshb
00201C C1 07              195. 		cmpb	#7		
00201E 22 0F              196. 		bhi	Outzero_return	; Kolla om talet 칛r >7
002020 CE 20 6C           197. 		ldx	#Bitmask
002023                    198. Outzero_loop:
002023                    199. 		ldab	b,x				; Uppdatera b till bitmasken f칬r b
002025 51                 200. 		comb	
002026 F4 20 19           201. 		andb	DCShadow		; Ta DCShadow && komplementet av bitmasken
002029 7B 04 00           202. 		stab	DrillControl	; Spara till borren
00202C 7B 20 19           203. 		stab	DCShadow	; Spara till skuggningen
00202F                    204. Outzero_return:	
00202F 33                 205. 		pulb			; 칀terst칛ll originalv칛rden
002030 38                 206. 		pulc
002031 3D                 207. 		rts
002032                    208. 	
                          209. ;---------------------------------
                          210. ;	OUTONE
                          211. ;---------------------------------
                          212. 
                          213. ; Ettst칛ll biten i B-registret, med f칬rprogrammerade bitm칬nster
                          214. 
002032                    215. Outone:			
002032 39                 216. 		pshc	; L칛gg register p친 stacken f칬r senare 친terst칛llning
002033 37                 217. 		pshb
002034 C1 07              218. 		cmpb	#7		
002036 22 0E              219. 		bhi	Outone_return	; Kolla om talet 칛r >7
002038 CE 20 6C           220. 		ldx	#Bitmask
00203B                    221. Outone_loop:
00203B                    222. 		ldab	b,x	
00203D FA 20 19           223. 		orab	DCShadow	; Ta DCShadow || Bitmasken
002040 7B 04 00           224. 		stab	DrillControl	; Spara till borren
002043 7B 20 19           225. 		stab	DCShadow	; Spara till skuggningen
002046                    226. Outone_return:	
002046 33                 227. 		pulb			; 칀terst칛ll originalv칛rden
002047 38                 228. 		pulc
002048 3D                 229. 		rts
002049                    230. 		
                          231. ;-------------------------------
                          232. ;	MOTORSTART
                          233. ;-------------------------------
                          234. 
002049                    235. MotorStart:
002049 37                 236. 	pshb
00204A F6 20 19           237. 	ldab	DCShadow
00204D C4 04              238. 	andb	#4
00204F 26 11              239. 	bne	MotorStartExit	; Motorn redan startad
002051 C6 02              240. 	ldab	#2
002053 16 20 32           241. 	jsr	Outone		; Ettst칛ll bit 2
002056 16 20 00           242. 	jsr	DELAY		; 4*250ms f칬rdr칬jning
002059 16 20 00           243. 	jsr	DELAY
00205C 16 20 00           244. 	jsr	DELAY
00205F 16 20 00           245. 	jsr	DELAY
                          246. 
002062                    247. MotorStartExit:
002062 33                 248. 	pulb
002063 3D                 249. 	rts
002064                    250. 	
                          251. ;-------------------------------
                          252. ;	MOTORSTOP
                          253. ;-------------------------------
                          254. 
002064                    255. MotorStop:
002064 37                 256. 	pshb
002065 C6 02              257. 	ldab	#2
002067 16 20 1A           258. 	jsr	Outzero		; Nollst칛ll bit 2
00206A 33                 259. 	pulb
00206B 3D                 260. 	rts
00206C                    261. 	
                          262. ;-------------------------------	
                          263. ;	Bitmasks
                          264. ;-------------------------------
                          265. 
00206C 01 02 04 08 10 20  266. Bitmask:	fcb	1,2,4,8,16,32,64,128
       40 80            
002074                    267. 		
                          268. 
002074                    269. 		
002074                    270. 	
002074                    271. 		
002074                    272. 		
002074                    273. 	
---- File: "C:\Users\Erik\Documents\GitHub\PIS\Bokuppgifter\Main.s12"
                          274. ;------------------------------
                          275. ;	Globala variabler
                          276. ;------------------------------
                          277. 
002074                    278. 	