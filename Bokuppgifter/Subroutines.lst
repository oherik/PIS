QA12 - MC68HC12 Absolute crossassembler, Version 1.6.3
(c) GMV 1989-2013


File: Subroutines.lst
                            1. 		#define	SIMUATOR
---- File: "C:\Users\Erik\Documents\GitHub\PIS\Bokuppgifter\Subroutines.s12"
                            2. 		use	Labdefs.s12
---- File: "Labdefs.s12"
                            3. ;Adresser
       0000 0600            4. DipSwitch	equ	$600
       0000 0700            5. HexDisplay	equ	$700
       0000 0400            6. DrillControl	equ	$400
       0000 0401            7. DrillStatus	equ	$401
                            8. 
000000                      9. #ifdef	SIMULATOR
                           15. #else
       0000 0004           16. DelayConst	EQU	4
                           17. #endif                           18. 		use	Delay.s12
---- File: "Delay.s12"
                           19. 	use	Labdefs.s12
---- File: "Labdefs.s12"
                           20. ;Adresser
       0000 0600           21. DipSwitch	equ	$600
       0000 0700           22. HexDisplay	equ	$700
       0000 0400           23. DrillControl	equ	$400
       0000 0401           24. DrillStatus	equ	$401
                           25. 
000000                     26. #ifdef	SIMULATOR
                           32. #else
       0000 0004           33. DelayConst	EQU	4
                           34. #endif002000                     35. 	org	$2000
---- File: "Delay.s12"
002000 34                  36. DELAY:	pshx
002001 35                  37. 	pshy
002002 CE 00 04            38. 	ldx	#DelayConst
002005 1A 1F               39. NEXT:	leax	-1,x
002007 CD 00 64            40. 	ldy	#100
00200A 19 5F               41. NEXT2:	leay	-1,y
00200C 8D 00 00            42. 	cpy	#0
00200F 26 F9               43. 	bne	NEXT2
002011 8E 00 00            44. 	cpx	#0
002014 26 EF               45. 	bne	NEXT
002016 31                  46. 	puly
002017 30                  47. 	pulx
002018 3D                  48. 	rts	       0000 0401           49. InPort		equ	$0401	; Läsa in?
---- File: "C:\Users\Erik\Documents\GitHub\PIS\Bokuppgifter\Subroutines.s12"
                           50. ;OutPort		equ	$0400	; Läsa in?
                           51. 
001000                     52. 		org	$1000	
001000 00                  53. DCShadow	rmb	1	; DrillControl shadow
001001 C6 00               54. Start:		ldab	#$00
001003 7B 10 00            55. 		stab	DCShadow
001006                     56. 		
001006 F6 04 01            57. Loop:		ldab	InPort
001009 16 10 31            58. 		jsr	Outone
00100C                     59. 		
00100C B6 10 00            60. 		ldaa	DCShadow
00100F                     61. 		;staa	OutPort
00100F                     62. 		
00100F 06 10 01            63. 		jmp	Start		
001012                     64. 		
                           65. ;---------------------------------
                           66. ;	OUTZERO
                           67. ;---------------------------------
                           68. ; Nollställ biten i B-registrer, med förprogrammerade bitmönster
001012 36                  69. Outzero:	psha			; Lägg register på stacken för senare återställning
001013 39                  70. 		pshc	
001014 37                  71. 		pshb
001015 C1 07               72. 		cmpb	#7		
001017 22 14               73. 		bhi	Outzero_return	; Kolla om talet är >7
001019 CE 10 72            74. 		ldx	#Bitmask
00101C                     75. Outzero_loop:
00101C                     76. 		ldab	b,x
00101E 51                  77. 		comb	
00101F 37                  78. 		pshb
001020 B6 10 00            79. 		ldaa	DCShadow
001023                     80. 		anda	0,sp		; Ta DCShadow && B
001025 1B 81               81. 		leas	1,sp
001027 7A 04 00            82. 		staa	DrillControl	; Spara till borren
00102A 7A 10 00            83. 		staa	DCShadow	; Spara till skuggningen
00102D                     84. Outzero_return:	
00102D 33                  85. 		pulb			; Återställ originalvärden
00102E 38                  86. 		pulc
00102F 32                  87. 		pula
001030 3D                  88. 		rts
001031                     89. 	
                           90. ;---------------------------------
                           91. ;	OUTONE
                           92. ;---------------------------------
                           93. 
                           94. ; Ettställ biten i B-registrer, med förprogrammerade bitmönster
001031 36                  95. Outone:		psha			; Lägg register på stacken för senare återställning
001032 39                  96. 		pshc	
001033 37                  97. 		pshb
001034 C1 07               98. 		cmpb	#7		
001036 22 13               99. 		bhi	Outone_return	; Kolla om talet är >7
001038 CE 10 72           100. 		ldx	#Bitmask
00103B                    101. Outone_loop:
00103B                    102. 		ldab	b,x	
00103D 37                 103. 		pshb
00103E B6 10 00           104. 		ldaa	DCShadow
001041                    105. 		oraa	0,sp		; Ta DCShadow || B
001043 1B 81              106. 		leas	1,sp
001045 7A 04 00           107. 		staa	DrillControl	; Spara till borren
001048 7A 10 00           108. 		staa	DCShadow	; Spara till skuggningen
00104B                    109. Outone_return:	
00104B 33                 110. 		pulb			; Återställ originalvärden
00104C 38                 111. 		pulc
00104D 32                 112. 		pula
00104E 3D                 113. 		rts
00104F                    114. 		
                          115. ;-------------------------------
                          116. ;	MOTORSTART
                          117. ;-------------------------------
                          118. 
00104F                    119. MotorStart:
00104F 37                 120. 	pshb
001050 F6 10 00           121. 	ldab	DCShadow
001053 C4 04              122. 	andb	#4
001055 26 11              123. 	bne	MotorStartExit	; Motorn redan startad
001057 C6 02              124. 	ldab	#2
001059 16 10 31           125. 	jsr	Outone		; Ettställ bit 2
00105C 16 20 00           126. 	jsr	DELAY		; 4*250ms fördröjning
00105F 16 20 00           127. 	jsr	DELAY
001062 16 20 00           128. 	jsr	DELAY
001065 16 20 00           129. 	jsr	DELAY
                          130. 
001068                    131. MotorStartExit:
001068 33                 132. 	pulb
001069 3D                 133. 	rts
00106A                    134. 	
                          135. ;-------------------------------
                          136. ;	MOTORSTOP
                          137. ;-------------------------------
                          138. 
00106A                    139. MotorStop:
00106A 37                 140. 	pshb
00106B C6 02              141. 	ldab	#2
00106D 16 10 12           142. 	jsr	Outzero		; Nollställ bit 2
001070 33                 143. 	pulb
001071 3D                 144. 	rts
001072                    145. 	
                          146. ;-------------------------------	
                          147. ;	Bitmasks
                          148. ;-------------------------------
                          149. 
001072 01 02 04 08 10 20  150. Bitmask:	fcb	1,2,4,8,16,32,64,128
       40 80            
00107A                    151. 		
                          152. 
00107A                    153. 		
00107A                    154. 	
00107A                    155. 		
00107A                    156. 		