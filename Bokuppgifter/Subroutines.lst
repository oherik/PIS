QA12 - MC68HC12 Absolute crossassembler, Version 1.6.3
(c) GMV 1989-2013


File: Subroutines.lst
                            1. #define	SIMUATOR
---- File: "C:\Users\Erik\Documents\GitHub\PIS\Bokuppgifter\Subroutines.s12"
                            2. #define	RUNFAST
                            3. 		use	Labdefs.s12
---- File: "Labdefs.s12"
                            4. ;Adresser
       0000 0600            5. DipSwitch	equ	$600
       0000 0700            6. HexDisplay	equ	$700
       0000 0400            7. DrillControl	equ	$400
       0000 0401            8. DrillStatus	equ	$401
                            9. 
000000                     10. #ifdef	SIMULATOR
                           16. #else
       0000 0004           17. DelayConst	EQU	4
                           18. #endif                           19. 		use	Delay.s12
---- File: "Delay.s12"
                           20. 	use	Labdefs.s12
---- File: "Labdefs.s12"
                           21. ;Adresser
       0000 0600           22. DipSwitch	equ	$600
       0000 0700           23. HexDisplay	equ	$700
       0000 0400           24. DrillControl	equ	$400
       0000 0401           25. DrillStatus	equ	$401
                           26. 
000000                     27. #ifdef	SIMULATOR
                           33. #else
       0000 0004           34. DelayConst	EQU	4
                           35. #endif002000                     36. 	org	$2000
---- File: "Delay.s12"
002000 34                  37. DELAY:	pshx		; 250 ms delay
002001 35                  38. 	pshy
002002 CE 00 04            39. 	ldx	#DelayConst
002005 1A 1F               40. NEXT:	leax	-1,x
002007 CD 00 64            41. 	ldy	#100
00200A 19 5F               42. NEXT2:	leay	-1,y
00200C 8D 00 00            43. 	cpy	#0
00200F 26 F9               44. 	bne	NEXT2
002011 8E 00 00            45. 	cpx	#0
002014 26 EF               46. 	bne	NEXT
002016 31                  47. 	puly
002017 30                  48. 	pulx
002018 3D                  49. 	rts	
002019                     50. 	
002019                     51. DELAY_B:		; Calls DELAY the number of times specified in B
002019 37                  52. 	pshb
00201A D7                  53. 	tstb
00201B                     54. DELAY_B_LOOP:
00201B 27 06               55. 	beq	DELAY_B_RETURN
00201D 16 20 00            56. 	jsr	DELAY
002020 53                  57. 	decb
002021 20 F8               58. 	bra	DELAY_B_LOOP
002023                     59. DELAY_B_RETURN:
002023 33                  60. 	pulb
002024 3D                  61. 	rts                            62. 
---- File: "C:\Users\Erik\Documents\GitHub\PIS\Bokuppgifter\Subroutines.s12"
002025 00                  63. DCShadow	rmb	1	; DrillControl shadow	
002026                     64. 		
                           65. ;---------------------------------
                           66. ;	OUTZERO
                           67. ;---------------------------------
                           68. 
                           69. ; Nollst√§ll biten i B-registret, med f√∂rprogrammerade bitm√∂nster
                           70. 
002026                     71. Outzero:			
002026 39                  72. 		pshc	; L√§gg register p√• stacken f√∂r senare √•terst√§llning
002027 37                  73. 		pshb
002028 C1 07               74. 		cmpb	#7		
00202A 22 0F               75. 		bhi	Outzero_return	; Kolla om talet √§r >7
00202C CE 20 AA            76. 		ldx	#Bitmask
00202F                     77. Outzero_loop:
00202F                     78. 		ldab	b,x				; Uppdatera b till bitmasken f√∂r b
002031 51                  79. 		comb	
002032 F4 20 25            80. 		andb	DCShadow		; Ta DCShadow && komplementet av bitmasken
002035 7B 04 00            81. 		stab	DrillControl	; Spara till borren
002038 7B 20 25            82. 		stab	DCShadow	; Spara till skuggningen
00203B                     83. Outzero_return:	
00203B 33                  84. 		pulb			; √Öterst√§ll originalv√§rden
00203C 38                  85. 		pulc
00203D 3D                  86. 		rts
00203E                     87. 	
                           88. ;---------------------------------
                           89. ;	OUTONE
                           90. ;---------------------------------
                           91. 
                           92. ; Ettst√§ll biten i B-registret, med f√∂rprogrammerade bitm√∂nster
                           93. 
00203E                     94. Outone:			
00203E 39                  95. 		pshc	; L√§gg register p√• stacken f√∂r senare √•terst√§llning
00203F 37                  96. 		pshb
002040 C1 07               97. 		cmpb	#7		
002042 22 0E               98. 		bhi	Outone_return	; Kolla om talet √§r >7
002044 CE 20 AA            99. 		ldx	#Bitmask
002047                    100. Outone_loop:
002047                    101. 		ldab	b,x	
002049 FA 20 25           102. 		orab	DCShadow	; Ta DCShadow || Bitmasken
00204C 7B 04 00           103. 		stab	DrillControl	; Spara till borren
00204F 7B 20 25           104. 		stab	DCShadow	; Spara till skuggningen
002052                    105. Outone_return:	
002052 33                 106. 		pulb			; √Öterst√§ll originalv√§rden
002053 38                 107. 		pulc
002054 3D                 108. 		rts
002055                    109. 		
                          110. ;-------------------------------
                          111. ;	MOTORSTART
                          112. ;-------------------------------
                          113. 
002055                    114. MotorStart:
002055 37                 115. 	pshb
002056 39                 116. 	pshc
002057 F6 20 25           117. 	ldab	DCShadow
00205A C4 04              118. 	andb	#4
00205C 26 0A              119. 	bne	MotorStartExit	; Motorn redan startad
00205E C6 02              120. 	ldab	#2
002060 16 20 3E           121. 	jsr	Outone		; Ettst√§ll bit 2
002063                    122. 	
002063 C6 02              123. 	ldab	#2
002065 16 20 19           124. 	jsr	DELAY_B	; 4*250 ms delay
                          125. 
002068                    126. MotorStartExit:
002068 38                 127. 	pulc
002069 33                 128. 	pulb
00206A 3D                 129. 	rts
00206B                    130. 	
                          131. ;-------------------------------
                          132. ;	MOTORSTOP
                          133. ;-------------------------------
                          134. 
00206B                    135. MotorStop:
00206B 37                 136. 	pshb
00206C 39                 137. 	pshc
00206D C6 02              138. 	ldab	#2
00206F 16 20 26           139. 	jsr	Outzero		; Nollst√§ll bit 2
002072 38                 140. 	pulc
002073 33                 141. 	pulb
002074 3D                 142. 	rts
002075                    143. 	
                          144. ;-------------------------------
                          145. ;	DRILLDOWN
                          146. ;-------------------------------
                          147. 
002075                    148. DrillDown:
002075 37                 149. 	pshb
002076 39                 150. 	pshc
002077 C6 03              151. 	ldab	#3		; Bit nummer 3 ‰r vridmagneten
002079 16 20 3E           152. 	jsr	Outone		; Ettst‰ll denna
00207C 38                 153. 	pulc
00207D 33                 154. 	pulb
00207E 3D                 155. 	rts
00207F                    156. 	
                          157. ;-------------------------------
                          158. ;	DRILLUP
                          159. ;-------------------------------
                          160. 
00207F                    161. DrillUp:
00207F 37                 162. 	pshb
002080 39                 163. 	pshc
002081 C6 03              164. 	ldab	#3		; Bit nummer 3 ‰r vridmagneten
002083 16 20 26           165. 	jsr	Outzero		; Nollst‰ll denna
002086 38                 166. 	pulc
002087 33                 167. 	pulb
002088 3D                 168. 	rts
002089                    169. 	
                          170. ;-------------------------------
                          171. ;	ALARM
                          172. ;-------------------------------
                          173. 
                          174. ; Antalet alarm ska finnas i B-registret
                          175. 
002089                    176. Alarm:
002089 39                 177. 	pshc
00208A B7 10              178. 	tfr	b,a
00208C 97                 179. 	tsta
00208D 27 19              180. 	beq	AlarmReturn
00208F                    181. 			; Bit nummer 4 ‰r larm
00208F                    182. AlarmSend:
00208F C6 04              183. 	ldab	#4		; S‰tt pÂ alarm
002091 16 20 3E           184. 	jsr	Outone
002094                    185. 	
002094 C6 04              186. 	ldab	#4
002096 16 20 19           187. 	jsr	DELAY_B		; 4*250 ms delay
002099                    188. 	
002099 C6 04              189. 	ldab	#4		; St‰ng av alarm
00209B 16 20 26           190. 	jsr	Outzero
00209E                    191. 	
00209E 43                 192. 	deca			
00209F 27 07              193. 	beq	AlarmReturn
0020A1                    194. 	
0020A1 C6 02              195. 	ldab	#2		; 2*250 ms delay
0020A3 16 20 19           196. 	jsr	DELAY_B
0020A6                    197. 	
0020A6 20 E7              198. 	bra	AlarmSend
0020A8                    199. AlarmReturn:
0020A8 38                 200. 	pulc
0020A9 3D                 201. 	rts
0020AA                    202. 	
0020AA                    203. 	
0020AA                    204. 	
0020AA                    205. 	
                          206. 
                          207. 
                          208. ;-------------------------------	
                          209. ;	Bitmasks
                          210. ;-------------------------------
                          211. 
0020AA 01 02 04 08 10 20  212. Bitmask:	fcb	1,2,4,8,16,32,64,128
       40 80            
0020B2                    213. 		
                          214. 
0020B2                    215. 		
0020B2                    216. 	
0020B2                    217. 		
0020B2                    218. 		
