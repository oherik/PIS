QA12 - MC68HC12 Absolute crossassembler, Version 1.6.3
(c) GMV 1989-2013


File: Subroutines.lst
                            1. #define	SIMUATOR
---- File: "C:\Users\Erik\Documents\GitHub\PIS\Bokuppgifter\Subroutines.s12"
                            2. #define	RUNFAST
                            3. 		use	Labdefs.s12
---- File: "Labdefs.s12"
                            4. ;Adresser
       0000 0600            5. DipSwitch	equ	$600
       0000 0700            6. HexDisplay	equ	$700
       0000 0400            7. DrillControl	equ	$400
       0000 0401            8. DrillStatus	equ	$401
                            9. 
000000                     10. #ifdef	SIMULATOR
                           16. #else
       0000 0004           17. DelayConst	EQU	4
                           18. #endif                           19. 		use	Delay.s12
---- File: "Delay.s12"
                           20. 	use	Labdefs.s12
---- File: "Labdefs.s12"
                           21. ;Adresser
       0000 0600           22. DipSwitch	equ	$600
       0000 0700           23. HexDisplay	equ	$700
       0000 0400           24. DrillControl	equ	$400
       0000 0401           25. DrillStatus	equ	$401
                           26. 
000000                     27. #ifdef	SIMULATOR
                           33. #else
       0000 0004           34. DelayConst	EQU	4
                           35. #endif002000                     36. 	org	$2000
---- File: "Delay.s12"
002000 34                  37. DELAY:	pshx
002001 35                  38. 	pshy
002002 CE 00 04            39. 	ldx	#DelayConst
002005 1A 1F               40. NEXT:	leax	-1,x
002007 CD 00 64            41. 	ldy	#100
00200A 19 5F               42. NEXT2:	leay	-1,y
00200C 8D 00 00            43. 	cpy	#0
00200F 26 F9               44. 	bne	NEXT2
002011 8E 00 00            45. 	cpx	#0
002014 26 EF               46. 	bne	NEXT
002016 31                  47. 	puly
002017 30                  48. 	pulx
002018 3D                  49. 	rts	                           50. 
---- File: "C:\Users\Erik\Documents\GitHub\PIS\Bokuppgifter\Subroutines.s12"
002019 00                  51. DCShadow	rmb	1	; DrillControl shadow	
00201A                     52. 		
                           53. ;---------------------------------
                           54. ;	OUTZERO
                           55. ;---------------------------------
                           56. 
                           57. ; Nollställ biten i B-registret, med förprogrammerade bitmönster
                           58. 
00201A                     59. Outzero:			
00201A 39                  60. 		pshc	; Lägg register på stacken för senare återställning
00201B 37                  61. 		pshb
00201C C1 07               62. 		cmpb	#7		
00201E 22 0F               63. 		bhi	Outzero_return	; Kolla om talet är >7
002020 CE 20 6C            64. 		ldx	#Bitmask
002023                     65. Outzero_loop:
002023                     66. 		ldab	b,x				; Uppdatera b till bitmasken för b
002025 51                  67. 		comb	
002026 F4 20 19            68. 		andb	DCShadow		; Ta DCShadow && komplementet av bitmasken
002029 7B 04 00            69. 		stab	DrillControl	; Spara till borren
00202C 7B 20 19            70. 		stab	DCShadow	; Spara till skuggningen
00202F                     71. Outzero_return:	
00202F 33                  72. 		pulb			; Återställ originalvärden
002030 38                  73. 		pulc
002031 3D                  74. 		rts
002032                     75. 	
                           76. ;---------------------------------
                           77. ;	OUTONE
                           78. ;---------------------------------
                           79. 
                           80. ; Ettställ biten i B-registret, med förprogrammerade bitmönster
                           81. 
002032                     82. Outone:			
002032 39                  83. 		pshc	; Lägg register på stacken för senare återställning
002033 37                  84. 		pshb
002034 C1 07               85. 		cmpb	#7		
002036 22 0E               86. 		bhi	Outone_return	; Kolla om talet är >7
002038 CE 20 6C            87. 		ldx	#Bitmask
00203B                     88. Outone_loop:
00203B                     89. 		ldab	b,x	
00203D FA 20 19            90. 		orab	DCShadow	; Ta DCShadow || Bitmasken
002040 7B 04 00            91. 		stab	DrillControl	; Spara till borren
002043 7B 20 19            92. 		stab	DCShadow	; Spara till skuggningen
002046                     93. Outone_return:	
002046 33                  94. 		pulb			; Återställ originalvärden
002047 38                  95. 		pulc
002048 3D                  96. 		rts
002049                     97. 		
                           98. ;-------------------------------
                           99. ;	MOTORSTART
                          100. ;-------------------------------
                          101. 
002049                    102. MotorStart:
002049 37                 103. 	pshb
00204A F6 20 19           104. 	ldab	DCShadow
00204D C4 04              105. 	andb	#4
00204F 26 11              106. 	bne	MotorStartExit	; Motorn redan startad
002051 C6 02              107. 	ldab	#2
002053 16 20 32           108. 	jsr	Outone		; Ettställ bit 2
002056 16 20 00           109. 	jsr	DELAY		; 4*250ms fördröjning
002059 16 20 00           110. 	jsr	DELAY
00205C 16 20 00           111. 	jsr	DELAY
00205F 16 20 00           112. 	jsr	DELAY
                          113. 
002062                    114. MotorStartExit:
002062 33                 115. 	pulb
002063 3D                 116. 	rts
002064                    117. 	
                          118. ;-------------------------------
                          119. ;	MOTORSTOP
                          120. ;-------------------------------
                          121. 
002064                    122. MotorStop:
002064 37                 123. 	pshb
002065 C6 02              124. 	ldab	#2
002067 16 20 1A           125. 	jsr	Outzero		; Nollställ bit 2
00206A 33                 126. 	pulb
00206B 3D                 127. 	rts
00206C                    128. 	
                          129. ;-------------------------------	
                          130. ;	Bitmasks
                          131. ;-------------------------------
                          132. 
00206C 01 02 04 08 10 20  133. Bitmask:	fcb	1,2,4,8,16,32,64,128
       40 80            
002074                    134. 		
                          135. 
002074                    136. 		
002074                    137. 	
002074                    138. 		
002074                    139. 		
