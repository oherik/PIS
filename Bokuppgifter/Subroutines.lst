QA12 - MC68HC12 Absolute crossassembler, Version 1.6.3
(c) GMV 1989-2013


File: Subroutines.lst
                            1. 		#define	SIMUATOR
---- File: "C:\Users\Erik\Documents\GitHub\PIS\Bokuppgifter\Subroutines.s12"
                            2. 		use	Labdefs.s12
---- File: "Labdefs.s12"
                            3. ;Adresser
       0000 0600            4. DipSwitch	equ	$600
       0000 0700            5. HexDisplay	equ	$700
       0000 0400            6. DrillControl	equ	$400
       0000 0401            7. DrillStatus	equ	$401
                            8. 
000000                      9. #ifdef	SIMULATOR
                           15. #else
       0000 0004           16. DelayConst	EQU	4
                           17. #endif                           18. 		use	Delay.s12
---- File: "Delay.s12"
000000                     19. #ifdef	RUNFAST
                           21. #else
       0000 0001           22. DelayConstant	equ	1	;Minimum number for the constant, the delay will however be too long
                           23. #endif
000000                     24. 	
002000                     25. 	org	$2000
002000 34                  26. Delay:	pshx
002001 35                  27. 	pshy
002002 CE 00 01            28. 	ldx	#DelayConstant
002005 1A 1F               29. NEXT:	leax	-1,x
002007 CD 00 64            30. 	ldy	#100
00200A 19 5F               31. NEXT2:	leay	-1,y
00200C 8D 00 00            32. 	cpy	#0
00200F 26 F9               33. 	bne	NEXT2
002011 8E 00 00            34. 	cpx	#0
002014 26 EF               35. 	bne	NEXT
002016 31                  36. 	puly
002017 30                  37. 	pulx
002018 3D                  38. 	rts	       0000 0401           39. InPort		equ	$0401	; Läsa in?
---- File: "C:\Users\Erik\Documents\GitHub\PIS\Bokuppgifter\Subroutines.s12"
       0000 0400           40. OutPort		equ	$0400	; Läsa in?
                           41. 
001000                     42. 		org	$1000	
001000 00                  43. DCShadow	rmb	1	; DrillControl shadow
001001 C6 00               44. Start:		ldab	#$00
001003 7B 10 00            45. 		stab	DCShadow
001006                     46. 		
001006 F6 04 01            47. Loop:		ldab	InPort
001009 16 10 34            48. 		jsr	Outone
00100C                     49. 		
00100C B6 10 00            50. 		ldaa	DCShadow
00100F 7A 04 00            51. 		staa	OutPort
001012                     52. 		
001012 06 10 01            53. 		jmp	Start		
001015                     54. 		
                           55. ;---------------------------------
                           56. ;	OUTZERO
                           57. ;---------------------------------
                           58. ; Nollställ biten i B-registrer, med förprogrammerade bitmönster
001015 36                  59. Outzero:	psha			; Lägg register på stacken för senare återställning
001016 39                  60. 		pshc	
001017 37                  61. 		pshb
001018 C1 07               62. 		cmpb	#7		
00101A 22 14               63. 		bhi	Outzero_return	; Kolla om talet är >7
00101C CE 10 77            64. 		ldx	#Bitmask
00101F                     65. Outzero_loop:
00101F                     66. 		ldab	b,x
001021 51                  67. 		comb	
001022 37                  68. 		pshb
001023 B6 10 00            69. 		ldaa	DCShadow
001026                     70. 		anda	0,sp		; Ta DCShadow && B
001028 1B 81               71. 		leas	1,sp
00102A 7A 04 00            72. 		staa	DrillControl	; Spara till borren
00102D 7A 10 00            73. 		staa	DCShadow	; Spara till skuggningen
001030                     74. Outzero_return:	
001030 33                  75. 		pulb			; Återställ originalvärden
001031 38                  76. 		pulc
001032 32                  77. 		pula
001033 3D                  78. 		rts
001034                     79. 	
                           80. ;---------------------------------
                           81. ;	OUTONE
                           82. ;---------------------------------
                           83. 
                           84. ; Ettställ biten i B-registrer, med förprogrammerade bitmönster
001034 36                  85. Outone:		psha			; Lägg register på stacken för senare återställning
001035 39                  86. 		pshc	
001036 37                  87. 		pshb
001037 C1 07               88. 		cmpb	#7		
001039 22 13               89. 		bhi	Outone_return	; Kolla om talet är >7
00103B CE 10 77            90. 		ldx	#Bitmask
00103E                     91. Outone_loop:
00103E                     92. 		ldab	b,x	
001040 37                  93. 		pshb
001041 B6 10 00            94. 		ldaa	DCShadow
001044                     95. 		oraa	0,sp		; Ta DCShadow || B
001046 1B 81               96. 		leas	1,sp
001048 7A 04 00            97. 		staa	DrillControl	; Spara till borren
00104B 7A 10 00            98. 		staa	DCShadow	; Spara till skuggningen
00104E                     99. Outone_return:	
00104E 33                 100. 		pulb			; Återställ originalvärden
00104F 38                 101. 		pulc
001050 32                 102. 		pula
001051 3D                 103. 		rts
001052                    104. 		
                          105. ;-------------------------------
                          106. ;	MOTORSTART
                          107. ;-------------------------------
                          108. 
001052                    109. MotorStart:
001052 36                 110. 	psha
001053 B6 10 00           111. 	ldaa	DCShadow
001056 84 04              112. 	anda	#4
001058 26 12              113. 	bne	MotorStartExit	; Motorn redan startad
00105A 86 02              114. 	ldaa	#2
00105C 36                 115. 	psha
00105D 16 10 34           116. 	jsr	Outone		; Ettställ bit 2	
001060 16 20 00           117. 	jsr	Delay		; 4*250ms fördröjning
001063 16 20 00           118. 	jsr	Delay
001066 16 20 00           119. 	jsr	Delay
001069 16 20 00           120. 	jsr	Delay
                          121. 
00106C                    122. MotorStartExit:
00106C 32                 123. 	pula
00106D 3D                 124. 	rts
                          125. ;-------------------------------
                          126. ;	MOTORSTOPP
                          127. ;-------------------------------
                          128. 
00106E                    129. MotorStopp
00106E 36                 130. 	psha
00106F 86 02              131. 	ldaa	#2
001071 36                 132. 	psha
001072 16 10 15           133. 	jsr	Outzero		; Nollställ bit 2
001075 32                 134. 	pula
001076 3D                 135. 	rts
001077                    136. 	
                          137. ;-------------------------------	
                          138. ;	Bitmasks
                          139. ;-------------------------------
                          140. 
001077 01 02 04 08 10 20  141. Bitmask:	fcb	1,2,4,8,16,32,64,128
       40 80            
00107F                    142. 		
                          143. 
00107F                    144. 		
00107F                    145. 	
00107F                    146. 		
00107F                    147. 		