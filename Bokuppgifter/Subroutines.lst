QA12 - MC68HC12 Absolute crossassembler, Version 1.6.3
(c) GMV 1989-2013


File: Subroutines.lst
                            1. 		#define	SIMUATOR
---- File: "C:\Users\Erik\Documents\GitHub\PIS\Bokuppgifter\Subroutines.s12"
                            2. 		use	Labdefs.s12
---- File: "Labdefs.s12"
                            3. ;Adresser
       0000 0600            4. DipSwitch	equ	$600
       0000 0700            5. HexDisplay	equ	$700
       0000 0400            6. DrillControl	equ	$400
       0000 0401            7. DrillStatus	equ	$401
                            8. 
000000                      9. #ifdef	SIMULATOR
                           15. #else
       0000 0004           16. DelayConst	EQU	4
                           17. #endif                           18. 		use	Delay.s12
---- File: "Delay.s12"
000000                     19. #ifdef	RUNFAST
                           21. #else
       0000 0001           22. DelayConstant	equ	1	;Minimum number for the constant, the delay will however be too long
                           23. #endif
000000                     24. 	
002000                     25. 	org	$2000
002000 34                  26. DELAY:	pshx
002001 35                  27. 	pshy
002002 CE 00 01            28. 	ldx	#DelayConstant
002005 1A 1F               29. NEXT:	leax	-1,x
002007 CD 00 64            30. 	ldy	#100
00200A 19 5F               31. NEXT2:	leay	-1,y
00200C 8D 00 00            32. 	cpy	#0
00200F 26 F9               33. 	bne	NEXT2
002011 8E 00 00            34. 	cpx	#0
002014 26 EF               35. 	bne	NEXT
002016 31                  36. 	puly
002017 30                  37. 	pulx
002018 3D                  38. 	rts	       0000 0401           39. InPort		equ	$0401	; Läsa in?
---- File: "C:\Users\Erik\Documents\GitHub\PIS\Bokuppgifter\Subroutines.s12"
                           40. ;OutPort		equ	$0400	; Läsa in?
                           41. 
001000                     42. 		org	$1000	
001000 00                  43. DCShadow	rmb	1	; DrillControl shadow
001001 C6 00               44. Start:		ldab	#$00
001003 7B 10 00            45. 		stab	DCShadow
001006                     46. 		
001006 F6 04 01            47. Loop:		ldab	InPort
001009 16 10 31            48. 		jsr	Outone
00100C                     49. 		
00100C B6 10 00            50. 		ldaa	DCShadow
00100F                     51. 		;staa	OutPort
00100F                     52. 		
00100F 06 10 01            53. 		jmp	Start		
001012                     54. 		
                           55. ;---------------------------------
                           56. ;	OUTZERO
                           57. ;---------------------------------
                           58. ; Nollställ biten i B-registrer, med förprogrammerade bitmönster
001012 36                  59. Outzero:	psha			; Lägg register på stacken för senare återställning
001013 39                  60. 		pshc	
001014 37                  61. 		pshb
001015 C1 07               62. 		cmpb	#7		
001017 22 14               63. 		bhi	Outzero_return	; Kolla om talet är >7
001019 CE 10 74            64. 		ldx	#Bitmask
00101C                     65. Outzero_loop:
00101C                     66. 		ldab	b,x
00101E 51                  67. 		comb	
00101F 37                  68. 		pshb
001020 B6 10 00            69. 		ldaa	DCShadow
001023                     70. 		anda	0,sp		; Ta DCShadow && B
001025 1B 81               71. 		leas	1,sp
001027 7A 04 00            72. 		staa	DrillControl	; Spara till borren
00102A 7A 10 00            73. 		staa	DCShadow	; Spara till skuggningen
00102D                     74. Outzero_return:	
00102D 33                  75. 		pulb			; Återställ originalvärden
00102E 38                  76. 		pulc
00102F 32                  77. 		pula
001030 3D                  78. 		rts
001031                     79. 	
                           80. ;---------------------------------
                           81. ;	OUTONE
                           82. ;---------------------------------
                           83. 
                           84. ; Ettställ biten i B-registrer, med förprogrammerade bitmönster
001031 36                  85. Outone:		psha			; Lägg register på stacken för senare återställning
001032 39                  86. 		pshc	
001033 37                  87. 		pshb
001034 C1 07               88. 		cmpb	#7		
001036 22 13               89. 		bhi	Outone_return	; Kolla om talet är >7
001038 CE 10 74            90. 		ldx	#Bitmask
00103B                     91. Outone_loop:
00103B                     92. 		ldab	b,x	
00103D 37                  93. 		pshb
00103E B6 10 00            94. 		ldaa	DCShadow
001041                     95. 		oraa	0,sp		; Ta DCShadow || B
001043 1B 81               96. 		leas	1,sp
001045 7A 04 00            97. 		staa	DrillControl	; Spara till borren
001048 7A 10 00            98. 		staa	DCShadow	; Spara till skuggningen
00104B                     99. Outone_return:	
00104B 33                 100. 		pulb			; Återställ originalvärden
00104C 38                 101. 		pulc
00104D 32                 102. 		pula
00104E 3D                 103. 		rts
00104F                    104. 		
                          105. ;-------------------------------
                          106. ;	MOTORSTART
                          107. ;-------------------------------
                          108. 
00104F                    109. MotorStart:
00104F 36                 110. 	psha
001050 B6 10 00           111. 	ldaa	DCShadow
001053 84 04              112. 	anda	#4
001055 26 12              113. 	bne	MotorStartExit	; Motorn redan startad
001057 86 02              114. 	ldaa	#2
001059 36                 115. 	psha
00105A 16 10 31           116. 	jsr	Outone		; Ettställ bit 2	
00105D 16 20 00           117. 	jsr	DELAY		; 4*250ms fördröjning
001060 16 20 00           118. 	jsr	DELAY
001063 16 20 00           119. 	jsr	DELAY
001066 16 20 00           120. 	jsr	DELAY
                          121. 
001069                    122. MotorStartExit:
001069 32                 123. 	pula
00106A 3D                 124. 	rts
                          125. ;-------------------------------
                          126. ;	MOTORSTOP
                          127. ;-------------------------------
                          128. 
00106B                    129. MotorStop:
00106B 36                 130. 	psha
00106C 86 02              131. 	ldaa	#2
00106E 36                 132. 	psha
00106F 16 10 12           133. 	jsr	Outzero		; Nollställ bit 2
001072 32                 134. 	pula
001073 3D                 135. 	rts
001074                    136. 	
                          137. ;-------------------------------	
                          138. ;	Bitmasks
                          139. ;-------------------------------
                          140. 
001074 01 02 04 08 10 20  141. Bitmask:	fcb	1,2,4,8,16,32,64,128
       40 80            
00107C                    142. 		
                          143. 
00107C                    144. 		
00107C                    145. 	
00107C                    146. 		
00107C                    147. 		